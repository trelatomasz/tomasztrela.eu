---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import BlogHeader from '../components/BlogHeader.astro';
import BlogCard from '../components/BlogCard.astro';
import CategoryFilter from '../components/CategoryFilter.astro';
import { formatBlogPost, sortPostsByDate, getFeaturedPost, getAllTags } from '../utils/blog';

// Get all blog posts
const allPosts = await getCollection('blog');
const formattedPosts = allPosts.map(formatBlogPost);
const sortedPosts = sortPostsByDate(formattedPosts);
const featuredPost = getFeaturedPost(sortedPosts);
const regularPosts = sortedPosts.filter(post => !post.featured);
const categories = getAllTags(sortedPosts);
---

<Layout title="Blog - Tomasz Trela">
  <div class="space-y-8">
    <BlogHeader 
      title="Blog" 
      description="Thoughts, tutorials, and insights about web development, technology, AI and more."
    />

    <CategoryFilter categories={categories} />
    {featuredPost && (
      <section class="py-8">
        <h2 class="text-2xl font-bold text-primary-400 mb-6">Featured Post</h2>
        <BlogCard {...featuredPost} featured={true} />
      </section>
    )}

    <section class="py-8">
      <h2 class="text-2xl font-bold text-primary-400 mb-6">All Posts</h2>
      <div class="grid md:grid-cols-2 gap-6">
        {regularPosts.map(post => (
          <BlogCard {...post} />
        ))}
      </div>
    </section>

    
  </div>
</Layout> 